import geopandas as gpd
import pydeck as pdk
import streamlit as st
import matplotlib.pyplot as plt

categoria = ["Junin", "Pasco", "Arequipa", "Lima"]
valores = [0, 1.1, 1.4142, 99]

def set_data(ax, categoria, valores, lineas):		# Crear gráfico, múltiples gráficos sin usar muchas líneas
    ax.bar(categoria, valores)  # Use ax instead of fig
    ax.set_title(lineas[0])
    ax.set_xlabel(lineas[1])
    ax.set_ylabel(lineas[2])

st.set_page_config(layout="wide")			        # Ensanchar pantalla

gdf = gpd.read_file("peru_regions.shp") 		    # Abrir archivo

geojson_data = gdf.to_json()				        # Conversión de archivo a json

view_state = pdk.ViewState(latitude=-9.19, longitude=-75.0152, zoom=5, pitch=0)

layer = pdk.Layer(					                # Características de imagen
    "GeoJsonLayer",
    data=geojson_data,
    get_fill_color="[200, 30, 0, 160]",
    get_line_color=[255, 255, 255],
)

deck = pdk.Deck(layers=[layer], initial_view_state=view_state)

c_1, c_2, c_3 = st.columns([4, 8, 4])			    # Columnas

with c_1:						                    # Gasto anual
    fig3, ax3 = plt.subplots()
    set_data(ax3, categoria, valores, ["Gasto anual", "Departamentos", "Soles"])
    st.pyplot(fig3)


with c_2:						                    # Mapa
    st.pydeck_chart(deck)

    df = gdf.drop(columns="geometry")
    st.write(df)


with c_3:						                    # Comparador y gráficos
    fig, ax = plt.subplots()                        # Corrected: get both fig and ax
    set_data(ax, categoria, valores, ["Comparador", "Departamentos", "Valores"])

    fig2, ax2 = plt.subplots()
    set_data(ax2, categoria, valores, ["Gráficos", "Departamentos", "Gastos públicos"])

    st.pyplot(fig)
    st.pyplot(fig2)
